<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Taylor's Pantry ‚Äî Recipe Finder</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#0f62fe;--muted:#6b7280}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111}
    .container{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:1.4rem}
    .subtitle{color:var(--muted);font-size:0.92rem}
    .panel{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(12,20,40,0.06)}
    .search-row{display:flex;gap:8px;flex-wrap:wrap}
    input[type=text]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:0.95rem}
    button{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(15,98,254,0.12)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:16px}
    .card{background:var(--card);border-radius:10px;overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:150px;object-fit:cover}
    .card-body{padding:10px;display:flex;flex-direction:column;gap:8px}
    .card-title{font-weight:600}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .fav-btn{background:transparent;border:none;cursor:pointer;font-size:1.05rem}
    .no-results{text-align:center;color:var(--muted);padding:28px}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;padding:16px}
    .modal{background:var(--card);max-width:820px;width:100%;border-radius:12px;max-height:90vh;overflow:auto;padding:18px}
    .ingredients{display:flex;flex-wrap:wrap;gap:8px}
    .ing{background:#eef2ff;padding:6px 10px;border-radius:8px;font-size:0.9rem}
    .controls{display:flex;gap:8px;align-items:center}
    .favorites-list{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .fav-mini{display:flex;align-items:center;gap:8px;background:#fff;padding:8px;border-radius:8px;box-shadow:0 4px 10px rgba(10,10,30,0.03)}
    @media (max-width:520px){.card img{height:120px}}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + ReactDOM + Babel (for in-browser JSX) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <script type="text/babel">
    const {useState, useEffect} = React;
    const API_BASE = 'https://www.themealdb.com/api/json/v1/1';

    function App(){
      const [query, setQuery] = useState('egg, tomato');
      const [loading, setLoading] = useState(false);
      const [meals, setMeals] = useState([]);
      const [selected, setSelected] = useState(null);
      const [message, setMessage] = useState('Enter one or more ingredients separated by commas (e.g. chicken, onion)');
      const [favorites, setFavorites] = useState(() => {
        try{ return JSON.parse(localStorage.getItem('taylor_favs')||'[]'); }catch(e){return []}
      });

      useEffect(()=>{localStorage.setItem('taylor_favs', JSON.stringify(favorites));},[favorites]);

      async function search(){
        const raw = query.split(',').map(s=>s.trim()).filter(Boolean);
        if(raw.length===0){ setMessage('Please add at least one ingredient.'); setMeals([]); return; }
        setLoading(true); setMessage('Searching...');

        try{
          // For each ingredient, fetch filtered meals and collect sets of ids
          const allResults = await Promise.all(raw.map(async ing => {
            const url = `${API_BASE}/filter.php?i=${encodeURIComponent(ing)}`;
            const res = await fetch(url);
            const j = await res.json();
            return j.meals || [];
          }));

          // If only one ingredient, show its results
          let intersection = allResults[0].map(m=>m.idMeal);
          for(let i=1;i<allResults.length;i++){
            const ids = new Set(allResults[i].map(m=>m.idMeal));
            intersection = intersection.filter(id=>ids.has(id));
          }

          // Map ids back to meal objects (use first occurrence)
          const idToMeal = {};
          allResults.flat().forEach(m=>{ if(!idToMeal[m.idMeal]) idToMeal[m.idMeal]=m; });
          const finalMeals = intersection.map(id=>idToMeal[id]);

          if(finalMeals.length===0){ setMeals([]); setMessage('No recipes found that match all ingredients. Try fewer ingredients or check spelling.'); }
          else{ setMeals(finalMeals); setMessage(''); }
        }catch(err){ console.error(err); setMessage('Error fetching recipes. Try again.'); setMeals([]); }
        setLoading(false);
      }

      async function viewDetails(id){
        setSelected({loading:true});
        try{
          const res = await fetch(`${API_BASE}/lookup.php?i=${id}`);
          const j = await res.json();
          const meal = j.meals && j.meals[0];
          if(meal){
            // collect ingredients
            const ingredients = [];
            for(let i=1;i<=20;i++){
              const ing = meal['strIngredient'+i];
              const measure = meal['strMeasure'+i];
              if(ing && ing.trim()) ingredients.push({ing:ing.trim(), measure: measure?measure.trim():''});
            }
            setSelected({...meal, ingredients});
          } else setSelected(null);
        }catch(err){console.error(err); setSelected(null);}    
      }

      function toggleFavorite(meal){
        const exists = favorites.find(f=>f.idMeal===meal.idMeal);
        if(exists) setFavorites(favorites.filter(f=>f.idMeal!==meal.idMeal));
        else setFavorites([...favorites, meal]);
      }

      function removeFav(id){ setFavorites(favorites.filter(f=>f.idMeal!==id)); }

      return (
        <div className="container">
          <header>
            <div style={{flex:1}}>
              <h1>Taylor's Pantry ‚Äî Recipe Finder</h1>
              <div className="subtitle">Type ingredients you have (comma separated). The app will find recipes that include all of them.</div>
            </div>
            <div className="controls">
              <button className="ghost" onClick={()=>{setQuery('chicken, rice');}}>Example</button>
              <button onClick={()=>{ setMeals([]); setMessage(''); setQuery(''); localStorage.removeItem('taylor_favs'); setFavorites([]); }}>Reset</button>
            </div>
          </header>

          <div className="panel">
            <div className="search-row">
              <input type="text" value={query} placeholder="eg. chicken, onion, garlic" onChange={e=>setQuery(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') search(); }} />
              <button onClick={search}>{loading? 'Searching...' : 'Search'}</button>
              <button className="ghost" onClick={()=>{ setMeals([]); setMessage('Saved recipes are below.'); }}>Saved</button>
            </div>

            <div style={{marginTop:12}}>
              {message && <div style={{padding:12}} className="no-results">{message}</div>}

              {meals.length>0 && (
                <div>
                  <h3 style={{margin:'8px 0'}}>Results ({meals.length})</h3>
                  <div className="grid">
                    {meals.map(meal=> (
                      <div key={meal.idMeal} className="card">
                        <img src={meal.strMealThumb} alt={meal.strMeal} />
                        <div className="card-body">
                          <div className="card-title">{meal.strMeal}</div>
                          <div className="meta">
                            <div style={{fontSize:12,color:'var(--muted)'}}>ID: {meal.idMeal}</div>
                            <div>
                              <button className="fav-btn" title="View details" onClick={()=>viewDetails(meal.idMeal)}>üîé</button>
                              <button className="fav-btn" title="Toggle favorite" onClick={()=>toggleFavorite(meal)}>{favorites.find(f=>f.idMeal===meal.idMeal)?'üíñ':'ü§ç'}</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {favorites.length>0 && (
                <div style={{marginTop:16}}>
                  <h3>Favorites</h3>
                  <div className="favorites-list">
                    {favorites.map(f=> (
                      <div key={f.idMeal} className="fav-mini">
                        <img src={f.strMealThumb} alt="thumb" style={{width:40,height:40,objectFit:'cover',borderRadius:6}} />
                        <div style={{fontSize:13}}>{f.strMeal}</div>
                        <div style={{marginLeft:8}}>
                          <button className="fav-btn" onClick={()=>viewDetails(f.idMeal)}>Details</button>
                          <button className="fav-btn" onClick={()=>removeFav(f.idMeal)}>üóëÔ∏è</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>

          {selected && (
            <div className="modal-backdrop" onClick={(e)=>{ if(e.target.className.includes('modal-backdrop')) setSelected(null); }}>
              <div className="modal" role="dialog" aria-modal="true">
                {selected.loading ? <div>Loading...</div> : (
                  <div>
                    <div style={{display:'flex',alignItems:'center',gap:12}}>
                      <img src={selected.strMealThumb} alt="thumb" style={{width:120,height:90,objectFit:'cover',borderRadius:8}} />
                      <div>
                        <h2 style={{margin:0}}>{selected.strMeal}</h2>
                        <div style={{color:'var(--muted)'}}>{selected.strArea} ‚Äî {selected.strCategory}</div>
                      </div>
                      <div style={{marginLeft:'auto'}}>
                        <button onClick={()=>{ toggleFavorite({idMeal:selected.idMeal,strMeal:selected.strMeal,strMealThumb:selected.strMealThumb}); }} className="ghost">{favorites.find(f=>f.idMeal===selected.idMeal)?'Remove Fav':'Save to Favorites'}</button>
                        <button onClick={()=>setSelected(null)} style={{marginLeft:8}}>Close</button>
                      </div>
                    </div>

                    <hr style={{margin:'12px 0'}} />

                    <h3>Ingredients</h3>
                    <div className="ingredients">
                      {selected.ingredients.map((it,i)=> <div key={i} className="ing">{it.measure} {it.ing}</div>)}
                    </div>

                    <h3 style={{marginTop:12}}>Instructions</h3>
                    <p style={{whiteSpace:'pre-wrap',lineHeight:1.5}}>{selected.strInstructions}</p>

                    {selected.strSource && (
                      <p>Source: <a href={selected.strSource} target="_blank" rel="noreferrer">Original recipe</a></p>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
